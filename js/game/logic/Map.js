var Map1=function(){function a(){var a={};return a.anim=new Laya.Sprite,a.body=new Laya.Image,a.body.anchorX=.5,a.body.anchorY=.5,a.body.skin="ui/c1_1.png",a.shadow=new Laya.Image,a.shadow.scaleX=200/156,a.shadow.scaleY=a.shadow.scaleX,a.shadow.skin="ui/yingzi.png",a.shadow.anchorX=.5,a.shadow.anchorY=.5,a.shadow.x=-10,a.shadow.y=10,a.blade=new Laya.Image,a.blade.skin="ui/c1_2.png",a.blade.anchorX=.5,a.blade.anchorY=.5,a.anim.addChild(a.shadow),a.anim.addChild(a.blade),a.anim.addChild(a.body),a.radius=100,a.dir=0,a.x=0,a.y=0,a.anim.visible=!1,a.speed=1,a.aiCounter=0,a.tailCount=4,Scene.carLayer.addChild(a.anim),a}function r(){s.mainCar.anim.x=0,s.mainCar.anim.y=160,s.mainCar.anim.scaleX=.8,s.mainCar.anim.scaleY=.8,s.mainCar.sign.visible=!1,s.mainCar.animCanRot.rotation=90,Scene.setCenter()}function e(a){a.anim.x=a.x,a.anim.y=a.y,a.animCanRot.rotation=a.dir,Car.syncShadow(a)}function n(){s.started=!1,s.roadRadiusMax=l[User.rank1+1],s.numTotal=d[User.rank1+1],s.radiusReduceTo=User.rank1<=1?500:750,s.roadRadius=s.roadRadiusMax,t=.7*s.roadRadius,o=360/(s.numTotal+1),function(){for(var a=0;a<s.blocks.length;a++){var r=s.blocks[a];r.x=0,r.y=0,r.anim.x=0,r.anim.y=0,r.anim.visible=!1}}(),!0===s.result&&Scene.refreshWall(),s.result=null;for(var a=Math.floor(Math.random()*s.numTotal),n=0,i=0;i<16;i++){var u=s.cars[i];if(i<s.numTotal){n===a&&(n+=1),u.photo.skin="res/jpgs/"+(1+Math.floor(60*Math.random()))+".jpg";c=n*o*Math.PI/180;u.x=t*Math.cos(c),u.y=t*Math.sin(c),e(u),Car.reset(u,c),n+=1,u.anim.visible=!1}else u.x=2e3,u.y=2e3,u.anim.x=2e3,u.anim.y=2e3,u.dead=!0,u.anim.visible=!1}var c=a*o*Math.PI/180;s.mainCar.x=t*Math.cos(c),s.mainCar.y=t*Math.sin(c),Car.reset(s.mainCar,c),e(s.mainCar),Scene.reset(),r(),Car.setLevelUpRate()}function i(a){if(!0!==a.dead){var r=a.x,e=a.y;if(a.killTimer>0&&(a.killTimer-=1),Car.addEnergy(a,.1),a.tailCount>0&&(a.tailCount-=1),0===a.showTailCount){a.showTailCount=3;var n=new Laya.Image;0===a.tailCount&&a.energy<100?n.skin="cars/"+a.tailName+".png":n.skin="cars/energyTail.png",n.scaleX=.5*(1+.2*a.level)*.5,n.scaleY=n.scaleX,n.anchorX=.5,n.anchorY=.5,n.x=a.x,n.y=a.y,n.rotation=a.dir-90,Scene.mapLayer.addChild(n),Laya.timer.once(0===a.tailCount?4*a.energy*(1+a.level/s.numTotal):200,null,function(){Laya.Tween.to(n,{scaleX:0,scaleY:0},300,null,Laya.Handler.create(null,function(){n.destroy()}))})}else a.showTailCount-=1;a.x+=a.speed*Math.cos(Math.PI*a.dir/180),a.y+=a.speed*Math.sin(Math.PI*a.dir/180),a.anim.x=a.x,a.anim.y=a.y,Car.syncShadow(a);for(var i=0;i<s.cars.length;i++){var t=s.cars[i];if(t!==a&&!0!==t.dead){var o=gmath.getDisSquare(a,t),l=Car.baseRadius+(a.level-1)*Car.radiusScale+(Car.baseRadius+(t.level-1)*Car.radiusScale);if(o<=l*l){a!==s.mainCar&&t!==s.mainCar||Laya.SoundManager.playSound("sounds/hit2"+Math.floor(1+2*Math.random())+".mp3",1),Car.col(a,t),Car.distort(a),Car.distort(t),a.lastHit=t,t.lastHit=a;var d={x:r-t.x,y:e-t.y},u=V2.getLength(d);a.x=t.x+d.x*(l+a.speed)/u,a.y=t.y+d.y*(l+a.speed)/u,Effect.play("comb",{x:(a.x+t.x)/2-95,y:(a.y+t.y)/2-94}),a.anim.x=a.x,a.anim.y=a.y,a.stunSpeed=a.speed/30,t.stunSpeed=t.speed/30,a!==s.mainCar&&t!==s.mainCar||Scene.shakeCamera()}}}for(var c=V2.getLength(a),m=!1,C=0;C<s.blocks.length;C++)V2.getLength({x:a.x-s.blocks[C].x,y:a.y-s.blocks[C].y})<s.blocks[C].radius+Car.baseRadius+(a.level-1)*Car.radiusScale&&(m=!0);if(c>s.roadRadius||!0===m){a.dead=!0,null!==a.lastHit&&(Car.kill(a.lastHit,a),Car.levelUp(a.lastHit,a.level)),Effect.play("boom",{x:a.x-180,y:a.y-150}),a!==s.mainCar&&a.lastHit!==s.mainCar||(Laya.SoundManager.playSound("sounds/dead2.mp3",1),a===s.mainCar&&Game.bgm.stop()),Laya.timer.once(200,null,function(){a.anim.visible=!1});for(var h=0,C=0;C<s.cars.length;C++)!0!==s.cars[C].dead&&(h+=1);return a===s.mainCar&&null===s.result&&(s.result=!1,Laya.timer.once(1e3,null,World.end),s.rank=h+1),void(0===h&&null===s.result&&(s.result=!0,s.rank=1,Laya.timer.once(1e3,null,World.end)))}if(a.stun>0)return a.stun-=1,void(a.speed-=a.stunSpeed);x=a.dir-a.animCanRot.rotation;Math.abs(x)<5?a.animCanRot.rotation=a.dir:(x=gmath.trunkDir2(x),a.animCanRot.rotation+=x/5),a.animCanRot.rotation=gmath.trunkDir(a.animCanRot.rotation);var y=Car.normalSpeed(a),b=y-a.speed;if(Math.abs(b)<1?a.speed=y:a.speed+=b/3,a!==s.mainCar){var g=a.dir;if(a.forbidTurnCounter>0&&(a.forbidTurnCounter-=1),c>s.roadRadius-100&&0===a.forbidTurnCounter)return a.dir=gmath.trunkDir(V2.getAng(a)+90+180*Math.random()),void(a.forbidTurnCounter=10);for(C=0;C<s.blocks.length;C++){var k={x:a.x-s.blocks[C].x,y:a.y-s.blocks[C].y};V2.getLength(k)<200+Car.baseRadius+(a.level-1)*Car.radiusScale&&0===a.forbidTurnCounter&&(a.forbidTurnCounter=10,a.dir=V2.getAng(k))}if(0===a.aiCounter){if(Math.random()>.5)a.dir=360*Math.random();else{for(var f=null,o=9999999999,C=0;C<s.cars.length;C++){var p=s.cars[C];if(p!==a&&!0!==p.dead){var v=gmath.getDisSquare(p,a);v<o&&(o=v,f=p)}}null!==f&&(a.dir=gmath.pAngle(f.x-a.x,f.y-a.y))}a.aiCounter=180}else a.aiCounter-=1;var x=a.dir-g;x=gmath.trunkDir2(x),Math.abs(x)>120&&(a.speed=0)}}}var s={};s.started=!1,s.roadRadiusMax=1e3,s.roadRadius=s.roadRadiusMax;var t=.66*s.roadRadiusMax;s.numTotal=6;var o=360/(s.numTotal+1);s.reduceSpeed=.2,s.cars=[],s.center,s.result,s.mainCar,s.blocks=[],s.start=function(){s.mainCar.sign.visible=!0,s.mainCar.anim.scaleX=.4,s.mainCar.anim.scaleY=.4,Game.bgm=Laya.SoundManager.playMusic("sounds/fight2.mp3",0),s.started=!0;for(a=0;a<s.blocks.length;a++)s.blocks[a].anim.visible=!0,s.blocks[a].x=0,s.blocks[a].y=0,s.blocks[a].anim.x=0,s.blocks[a].anim.y=0,s.blocks[a].radius=100,s.blocks[a].anim.scaleX=1,s.blocks[a].anim.scaleY=1,s.blocks[a].blade.rotation=0,Laya.Tween.from(s.blocks[a].anim,{scaleX:0,scaleY:0},1200,Laya.Ease.backOut),Laya.Tween.from(s.blocks[a].blade,{rotation:360},1200,Laya.Ease.backOut),-1!==User.rank1&&(s.blocks[a].blade.skin="ui/c"+(User.rank1+1)+"_2.png",s.blocks[a].body.skin="ui/c"+(User.rank1+1)+"_1.png",s.blocks[a].speed=.8*User.rank1+.1*Math.min(8,User.rank2));Monster.reset();for(var a=0;a<s.cars.length;a++)s.cars[a].anim.visible=!0,Car.syncShadow(s.cars[a]);s.mainCar.anim.x=s.mainCar.x,s.mainCar.anim.y=s.mainCar.y,s.mainCar.animCanRot.rotation=s.mainCar.dir,Car.syncShadow(s.mainCar),Scene.zoomOut()},s.end=function(){n()};var l=[1e3,1e3,1e3,1e3,1e3,1e3,1e3],d=[11,11,11,11,11,11,11];return s.resetMap=n,s.reset=function(){for(var a=0;a<16;a++){var r=Car.create();s.cars.push(r)}n()},s.update=function(){s.roadRadius>s.radiusReduceTo&&(s.roadRadius-=s.reduceSpeed),s.mainCar.dir!==Game.dir&&0===s.mainCar.stun&&(s.mainCar.dir=Game.dir),i(s.mainCar);for(var a=0;a<s.cars.length;a++)i(s.cars[a]);Scene.update()},s.init=function(){s.center={x:Laya.stage.width/2,y:Laya.stage.height/2},s.blocks.push(a()),s.blocks.push(a()),s.blocks.push(a()),s.blocks.push(a()),s.mainCar=Car.create({}),Car.setMain(s.mainCar),s.reset(),r(),Car.syncShadow(s.mainCar)},s}();